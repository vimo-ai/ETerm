import{r as h,w as _,d as S,c as w,b as i,k as a,e as s,f as m,p as k,m as A,n as b,q as g,t as x,F as C,i as N,s as $,x as D,l as O,o as M,g as R,h as I,v as L}from"./index-BCZSM4OO.js";import{c as F}from"./index-CUYCQoRX.js";import{_ as V}from"./GlitchText.vue_vue_type_script_setup_true_lang-KTHYRbQd.js";function z(e){const o={name:"root",fullPath:"",type:"folder",children:new Map,count:0};for(const d of e){const t=d.path.split("/").filter(Boolean);let r=o;o.count++;for(let c=0;c<t.length;c++){const u=t[c];if(!u)continue;const p=c===t.length-1;if(!r.children.has(u)){const l={name:u,fullPath:t.slice(0,c+1).join("/"),type:p?"project":"folder",children:new Map,count:0};r.children.set(u,l)}const y=r.children.get(u);y&&(r=y,r.count++,!p&&r.type==="project"&&(r.type="folder")),p&&(r.project=d,r.children.size===0&&(r.type="project"))}}return T(o),o}function T(e){for(const o of e.children.values())T(o);if(e.name!=="root"&&!e.project&&e.children.size===1){const o=e.children.values().next().value;e.name=`${e.name}/${o.name}`,e.fullPath=o.fullPath,e.type=o.type,e.project=o.project,e.children=o.children,e.count=o.count}}const P="memex:tree:expanded",f=h(new Set),E=h(!1);function B(){if(!E.value){try{const t=localStorage.getItem(P);if(t){const r=JSON.parse(t);Array.isArray(r)&&(f.value=new Set(r))}}catch(t){console.error("Failed to load tree state:",t)}E.value=!0}_(f,t=>{try{localStorage.setItem(P,JSON.stringify(Array.from(t)))}catch(r){console.error("Failed to save tree state:",r)}},{deep:!0});function e(t){return f.value.has(t)}function o(t){f.value.has(t)?f.value.delete(t):f.value.add(t)}function d(t,r){r?f.value.add(t):f.value.delete(t)}return{isExpanded:e,toggle:o,setExpanded:d}}const U={class:"select-none"},J={key:1,class:"i-carbon-cube text-xl"},q={class:"flex-1 min-w-0"},H={class:"flex items-center gap-3"},Y={class:"text-base font-bold text-gray-200 group-hover:text-white truncate font-display tracking-wide"},G={key:0,class:"text-[10px] font-mono px-1.5 py-0.5 rounded bg-neon-violet/10 text-neon-violet border border-neon-violet/20"},K={key:1,class:"text-[10px] font-mono px-1.5 py-0.5 rounded bg-neon-cyan/10 text-neon-cyan border border-neon-cyan/20"},Q={key:0,class:"text-xs text-gray-600 font-mono mt-1 flex items-center justify-between gap-4"},W={class:"flex gap-4"},X={key:0,class:"flex flex-col"},Z=S({__name:"ProjectTreeNode",props:{node:{},depth:{}},setup(e){const o=e,d=O(),{isExpanded:t,toggle:r}=B(),c=w(()=>o.depth||0),u=w(()=>o.node.children?Array.from(o.node.children.values()).sort((l,n)=>l.type!==n.type?l.type==="folder"?-1:1:l.name.localeCompare(n.name)):[]);function p(){o.node.type==="folder"?r(o.node.fullPath):o.node.project&&d.push(`/projects/${o.node.project.id}`)}function y(l){return new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"})}return(l,n)=>{const v=D("ProjectTreeNode",!0);return a(),i("div",U,[s("div",{class:b(["group relative bg-surface-100/30 border border-white/5 p-4 cursor-pointer hover:bg-surface-200/50 hover:border-neon-cyan/50 transition-all duration-300 mb-2 rounded-lg flex items-center gap-4",{"border-neon-cyan/30 bg-surface-200/30":g(t)(e.node.fullPath)}]),style:A({marginLeft:`${c.value*24}px`}),onClick:k(p,["stop"])},[n[2]||(n[2]=s("div",{class:"absolute inset-0 bg-neon-cyan/5 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none rounded-lg"},null,-1)),s("div",{class:b(["transition-colors flex-shrink-0",e.node.type==="folder"?"text-neon-violet":"text-gray-600 group-hover:text-neon-cyan"])},[e.node.type==="folder"?(a(),i("div",{key:0,class:b(["text-2xl",g(t)(e.node.fullPath)?"i-carbon-folder-open":"i-carbon-folder"])},null,2)):(a(),i("div",J))],2),s("div",q,[s("div",H,[s("h3",Y,x(e.node.name),1),e.node.type==="folder"?(a(),i("span",G,x(e.node.count)+" ITEMS ",1)):m("",!0),e.node.project?(a(),i("span",K," PROJECT ")):m("",!0)]),e.node.project?(a(),i("div",Q,[s("div",W,[s("span",null,x(e.node.project.sessionCount)+" SESSIONS",1),s("span",null,"UPDATED: "+x(y(e.node.project.updatedAt)),1)]),e.node.type==="folder"?(a(),i("button",{key:0,class:"px-2 py-0.5 rounded border border-neon-cyan/30 text-neon-cyan hover:bg-neon-cyan/10 transition-colors text-[10px] uppercase tracking-wider",onClick:n[0]||(n[0]=k(j=>g(d).push(`/projects/${e.node.project.id}`),["stop"]))}," Enter Project ")):m("",!0)])):m("",!0)]),e.node.type==="folder"?(a(),i("div",{key:0,class:b(["text-gray-600 transition-transform duration-300",{"rotate-90":g(t)(e.node.fullPath)}])},[...n[1]||(n[1]=[s("div",{class:"i-carbon-chevron-right"},null,-1)])],2)):m("",!0)],6),g(t)(e.node.fullPath)&&e.node.type==="folder"?(a(),i("div",X,[(a(!0),i(C,null,N(u.value,j=>(a(),$(v,{key:j.fullPath,node:j,depth:c.value+1},null,8,["node","depth"]))),128))])):m("",!0)])}}}),ee={class:"h-full flex flex-col px-8 pt-8"},te={class:"grid grid-cols-1 md:grid-cols-[1fr_auto] items-end mb-8 border-b border-white/5 pb-6 gap-4"},oe={class:"min-w-0"},ne={class:"relative group inline-block text-4xl font-bold text-white mb-2 max-w-full overflow-hidden text-ellipsis"},re={class:"text-xs font-mono text-neon-cyan tracking-widest truncate"},le={class:"relative group md:w-64"},se={class:"flex-1 overflow-y-auto pb-32 pr-2 scroll-smooth"},ae={key:0,class:"flex justify-center py-20"},ie={key:1,class:"text-center py-20 text-red-500 font-mono"},ce={key:2,class:"text-center py-20 text-gray-600 font-mono"},de={key:3,class:"flex flex-col gap-2"},he=S({__name:"ProjectsView",setup(e){const o=h([]),d=h(null),t=h(!0),r=h(null),c=h(""),u=w(()=>{if(!d.value)return[];if(c.value){const l=c.value.toLowerCase();return o.value.filter(n=>n.path.toLowerCase().includes(l)).map(n=>({name:y(n.path),fullPath:n.path,type:"project",project:n,count:0,children:new Map}))}return d.value.children?Array.from(d.value.children.values()).sort((l,n)=>l.type!==n.type?l.type==="folder"?-1:1:l.name.localeCompare(n.name)):[]});async function p(){t.value=!0,r.value=null;try{o.value=await F(),d.value=z(o.value)}catch(l){console.error("Failed to load projects:",l),r.value="CONNECTION FAILURE"}finally{t.value=!1}}function y(l){const n=l.split("/");return n[n.length-1]||l}return M(()=>{p()}),(l,n)=>(a(),i("div",ee,[s("div",te,[s("div",oe,[s("div",ne,[R(V,{text:"ARCHIVES"})]),s("div",re,x(o.value.length)+" DATA NODES DETECTED ",1)]),s("div",le,[n[1]||(n[1]=s("div",{class:"absolute inset-0 bg-neon-cyan/20 blur-md opacity-0 group-hover:opacity-100 transition-opacity"},null,-1)),I(s("input",{"onUpdate:modelValue":n[0]||(n[0]=v=>c.value=v),type:"text",placeholder:"SEARCH NODES...",class:"relative w-full bg-surface-100/80 border border-white/10 px-4 py-2 text-sm font-mono text-white focus:border-neon-cyan/50 focus:outline-none transition-colors"},null,512),[[L,c.value]])])]),s("div",se,[t.value?(a(),i("div",ae,[...n[2]||(n[2]=[s("div",{class:"i-carbon-circle-dash animate-spin text-4xl text-neon-cyan"},null,-1)])])):r.value?(a(),i("div",ie,x(r.value),1)):u.value.length===0?(a(),i("div",ce," EMPTY SECTOR ")):(a(),i("div",de,[(a(!0),i(C,null,N(u.value,v=>(a(),$(Z,{key:v.fullPath,node:v},null,8,["node"]))),128))]))])]))}});export{he as default};
